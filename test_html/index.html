<!doctype HTML>
<html>
<!-- A-Frame ライブラリの読み込み -->
<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<!-- AR.js ライブラリの読み込み -->
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!-- tracking.js ライブラリ読み込み -->
<script src="assets/javascript/tracking-min.js"></script>
  <style>
  video, canvas {
    position: absolute;
  }
  </style>
<body style='margin:0px; overflow:hidden;'>
<!-- こっからA-Frame -->
<a-scene embedded arjs="debugUIEnabled:false;">
    <!-- こっからARの世界。マーカー上になにを展開するかを書く -->
        <!-- H -->
        <a-marker preset="custom" type="pattern" url="marker/pattern-H.patt">
            <a-sphere scale=".25 .25 .25" position="0 .5 0" color="#00008b">
                <a-animation attribute="position" to="0 1 0" direction="alternate" dur="2000" repeat="indefinite">
                </a-animation>
            </a-sphere>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/pattern-H2.patt">
            <a-sphere scale=".25 .25 .25" position="0 .5 0" color="#00008b">
                <a-animation attribute="position" to="0 1 0" direction="alternate" dur="2000" repeat="indefinite">
                </a-animation>
            </a-sphere>
        </a-marker>

        <!-- He -->
        <a-marker preset="custom" type="pattern" url="marker/pattern-He.patt">
            <a-sphere scale=".25 .25 .25" position="0 .5 0" color="#ffff00">
                <a-animation attribute="position" to="0 1 0" direction="alternate" dur="2000" repeat="indefinite">
                </a-animation>
            </a-sphere>
        </a-marker>

        <!-- Li -->
        <a-marker preset="custom" type="pattern" url="marker/pattern-Li.patt">
            <a-sphere scale=".25 .25 .25" position="0 .5 0" color="#ffff00">
                <a-animation attribute="position" to="0 1 0" direction="alternate" dur="2000" repeat="indefinite">
                </a-animation>
            </a-sphere>
        </a-marker>
        
        <!-- Be -->
        <a-marker preset="custom" type="pattern" url="marker/pattern-Be.patt">
            <a-sphere scale=".25 .25 .25" position="0 .5 0" color="#ffff00">
                <a-animation attribute="position" to="0 1 0" direction="alternate" dur="2000" repeat="indefinite">
                </a-animation>
            </a-sphere>
        </a-marker>
    <!-- arなのでこんな感じでカメラが必要らしい。 -->
    <a-entity camera></a-entity>
</a-scene>
<!-- ここまででA-Frameおわり -->
<canvas id="canvas" width="800" height="500"></canvas>

<script>
    window.onload = function() {
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        tracking.ColorTracker.registerColor('purple', function(r, g, b) {
            var dx = r - 120;
            var dy = g - 60;
            var dz = b - 210;

            if ((b - g) >= 100 && (r - g) >= 60) {
                return true;
            }
            return dx * dx + dy * dy + dz * dz < 3500;
        });

        var tracker = new tracking.ColorTracker(['yellow', 'purple']);
        tracker.setMinDimension(30);

        tracking.track('#arjs-video', tracker);

        tracker.on('track', function(event) {
        context.clearRect(0, 0, canvas.width, canvas.height);

        event.data.forEach(function(rect) {
            if (rect.color === 'custom') {
            rect.color = tracker.customColor;
            }

            context.strokeStyle = rect.color;
            context.strokeRect(rect.x, rect.y, rect.width, rect.height);
            context.font = '11px Helvetica';
            context.fillStyle = "#fff";
            context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
            context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);
        });
        });

        initGUIControllers(tracker);
    };
</script>

</body>
</html>